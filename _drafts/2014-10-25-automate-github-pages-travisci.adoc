---
tags:
- jekyll
- github
- asciidoctor
- travisci
- howto
---
:imagesdir: /assets/images/2014-10-25
= Automate GitHub Pages publishing with Jekyll and Travis CI

Content is a *KING*. Neither fancy _CMS_ nor online _WYSYWIG_ are, but content is.
That's why `Jekyll` powered  `GitHub Pages` got such a popularity.
Just commit `HTML`, `Liquid`, `Markdown` markup etc, then files got processed by `Jekyll` 
and the whole site becomes available online in a minute.
However, if you'd like to use extra `Jekyll` features, for instance `AsciiDoctor`, you should manage `HTML` generation by yourself.
This quite boring activity could be simplified with `Travis CI` project and couple of other tricks that 
I'm going to describe in this post.

////
== Jekyll

One of the reasons of need for manual site generation is my preference to use `AsciiDoctor` as markup language.
Second change to default `Jekyll` config is caused by inability to make `Pygments` to work on my `Windows` PC,
so I've changed default `Jekyll` source code highlight library to `Coderay`. Below are the changes I've did to make `Jekyll` do what I want.

[source,ruby]
.Gemfile
----
source 'https://rubygems.org'
gem 'jekyll', '2.4.0'
gem 'asciidoctor', '1.5.1'
gem 'coderay', '1.1.0'
----
[source,yaml]
._config.yml
----
..
asciidoctor:
  attributes:
    - hardbreaks!
    - source-highlighter=coderay
..	
----
////

== Setting up Travis CI

The whole my idea was to make process of publishing my extended `Jekyll` staic site to `GitHub Pages`
as easy as possible - you just push files to `GitHub` and in couple of minutes site is available online.

=== Enable Hooks

image::2.png[Enable Travis CI hook]

=== Generate and encrypt GitHub token for Travis Ci

image::1.png[Generate GitHub token]

=== Travis config
[source,yaml]
.travis.yml
----
language: ruby
script: "./build.sh"
branches:
  only:
  - jekyll
rvm:
- 2.1.2
env:
  global:
    secure: HERE GOES ENCRYPTED STUFF
----

==== Build script

[source]
.build.sh
----
#/bin/bash
set -e

# build site
jekyll build

# clone `master' branch to different folder
rm -rf ../eshepelyuk.github.io.master
git clone https://${GH_TOKEN}@github.com/eshepelyuk/eshepelyuk.github.io.git ../eshepelyuk.github.io.master

# copy generated HTML site
cp -R _site/* ../eshepelyuk.github.io.master

# commit and push
cd ../eshepelyuk.github.io.master
git config user.email "eshepelyuk@gmail.com"
git config user.name "Evgeny Shepelyuk"
git add -A .
git commit -a -m "Travis #$TRAVIS_BUILD_NUMBER"
git push origin master
----