---
tags:
- java
- groovy
- spock
- javascript
- nashorn
- tdd
- jasmine
excerpt: |
  `JavaScript` is not only browser powered client-side or `NodeJS` powered server-side code.
  Many `JVM` based projects are also using it as internal scripting language.
  Testing this sort of functionality is neither straighforward nor standard.
  In this post I intend to show approach for testing `JavaScript` code in server-side JVM enviroinment 
  using well-known tools like `Jasmine`, `Spock` and `Nashorn`.
---
:imagesdir: /images/drafts
= Testing JVM server-side JavaScript using Jasmine, Spock and Nashorn

`JavaScript` is not only browser powered client-side or `NodeJS` powered server-side code.
Many `JVM` based projects are also using it as internal scripting language.
Testing this sort of functionality is neither straightforward nor standard.
In this post I intend to show approach for testing `JavaScript` code in server-side JVM environment
using well-known tools like `Jasmine`, `Spock` and `Nashorn`.

Using `JavaScript` as scripting engine inside JVM application has significant difference comparing to client-side coding.
There's no sufficient tools nowadays for the task of testing business script itself. Among disadvantages I'd like to outline following.

* lack of integration with build and _Continuous Integration_ tools (Maven, Gradle, Jenkins, etc.)
* no good integration with IDEs
** no possibility to run single test from IDE
** unable to view results from IDE
* tight coupling to browser environment
* no possibility of using customized `JavaScript` executor

As far as I've seen most projects test them  by calling JS engine runner, passing script under test to it and doing assertion by inspecting side-effects.

* hard to stub or mock, usually hacking on `prototype`
* hard to organize tests into suites and report errors
* too much orchestration because of previous issues

[source,java]
----
----

[source, javascript]
.jasmine-runner.js
----
<1>
----
<1> `Nashorn` specific code adjusting `Jasmine` for non-browser environments. Not a part of `Jasmine` distribution.

[source,groovy]
.Jasmine2Specification.groovy
----
<1>
----
<1> additional variable for data provider to underline ignored test

[source,groovy]
.JavaScriptTest.groovy
----
----

.Disadvantages
* unclear way of detecting line of source code particular where error happened
* still no ability to run single _specification_ from `Jasmine` suite
* incomplete reporting about ignored tests

image::1.png[]

NOTE: Full project's code is available at https://github.com/eshepelyuk/CodeForBlog/tree/master/TestMeIfYouCanNashornSpock[GitHub^]
